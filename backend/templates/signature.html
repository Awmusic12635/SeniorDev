<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Signature Form</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <!-- signature library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>

    <script>

     $(document).ready(function() {
         $(".clearButton").on('click', function () {
           signaturePad.clear();
        });

         $(".saveButton").on('click', function () {
             if (!signaturePad.isEmpty()) {
                 var dataurl = signaturePad.toDataURL();
                 var encoded = encodeURIComponent(dataurl);

                 $.ajax({
                     type: "GET",
                     url: "/signatureForm/save/"+encoded,
                     dataType: "json",
                     success: function (data) {
                         console.log(data);
                         if(data.saved) {
                             $('#resultsDiv').html = "<p>Signature saved successfully</p>";
                         }else{
                             $('#resultsDiv').html = "<p>Signature save failed</p>";
                         }
                     },
                     error: function () {
                         $('#resultsDiv').html = "<p>Signature save failed</p>";
                     }

                 });
             }else{
                 $('#resultsDiv').html = "<p>Please sign in the box</p>";
             }
         });

         var canvas = document.querySelector("canvas");
         var signaturePad = new SignaturePad(canvas);

     });


    </script>
</head>
<body>
<div>
    <p>Person: {{ checkout.person }}</p>
    <p>Items you are signing for:</p>
    {%  for ci in checkout.checkoutitem_set.all %}
        {%  if ci.item.ItemTypeID.needsSignature == True %}
            <p> Name: {{ ci.item.ItemTypeID.name}} : Due: {{ ci.dateTimeDue}} : Cost:{{ ci.item.ItemTypeID.cost}}</p>
        {% endif %}

    {% endfor %}
</div>
    <div id="signature-pad">
    <div class="m-signature-pad--body">
      <canvas></canvas>
    </div>
    <div class="m-signature-pad--footer">
      <div class="description">Sign above</div>
      <button type="button" class="clearButton">Clear</button>
      <button type="button" class="saveButton">Save Signature</button>
    </div>
  </div>

<div id = "resultsDiv"></div>
</body>
</html>